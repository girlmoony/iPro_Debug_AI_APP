# iPro_Debug_AI_APP

	i-PRO ADAM SDK sample app (Freestyle model) 
 ADAM, i-PRO, Panasonic, C++, SDK, スケルトンモデル, フリースタイル

 画像識別の確率を向上するため、
 ① テスト時の工夫（推論の改善）
Test Time Augmentation（TTA）
概要
TTAは、推論時に1枚の画像を複数パターンに変換（Augmentation）し、それらをモデルに入力して、予測結果を統合することで精度や安定性を向上させる手法です。
具体的な手順（画像認識の場合）
元のテスト画像を用意します。
以下のような複数のAugmentationを推論時に実施します（例えば5～10パターン程度）。
左右・上下反転
数度の回転（例：±5～15度）
拡大・縮小（例：0.9倍～1.1倍程度）
クロッピング（中央クロップやランダムクロップ）
明度・コントラスト調整（±数％程度の微調整）
各Augmentation画像をモデルに入力し、それぞれの予測結果（確率）を取得します。
取得した複数の予測結果（確率）を統合（平均または多数決）します。
統合方法の例
各クラスの予測確率を平均し、最も平均値が高いクラスを最終予測とする。
多数決により、複数推論結果で最も多く選ばれたクラスを採用する。
推奨：通常は確率平均が精度改善に有効。

モデルアンサンブル（前処理パターンによるアンサンブル）
概要
モデルそのものを変更せず、推論時の前処理を変化させた複数の予測結果を統合して精度向上を図る方法です。
具体的な手順
元の画像を異なる前処理パターンで処理します。
例：
前処理A：ノイズ除去処理（ガウシアンフィルター適用）
前処理B：コントラスト向上（ヒストグラム平坦化）
前処理C：高解像度維持処理（超解像技術を適用）
各処理済み画像に対して推論し、予測確率を取得します。
各推論結果を確率平均または多数決で統合し、最終的な結果とします。
注意点
それぞれの前処理が異なる強みを発揮するように調整するとより効果的です。
あまりにも大きく異なる処理を行うと、逆に精度が下がる可能性もあるため注意が必要です。


② 後処理（推論結果の調整）
閾値調整
概要
画像分類モデルが出力する予測確率の閾値を調整することで、False PositiveやFalse Negativeのバランスを最適化します。
具体的な手順
モデルの予測結果は通常、各クラスの確率値（例：0.0～1.0）で得られます。
初期状態では、多くの場合0.5を閾値として分類します（0.5以上なら陽性）。
**Validationデータ（検証用データ）**に対して以下の方法で最適な閾値を決定します。
様々な閾値（例：0.3～0.8）を試しながら、精度、再現率、F1スコアなどを評価します。
ROC曲線またはPrecision-Recall曲線を描き、最適な閾値を特定します。
実運用時にはこの最適化した閾値を用いて推論結果を決定します。
閾値調整のポイント
クラス不均衡の場合は特に重要（稀なクラスを検知したい場合は閾値を低くするなど）。
ROC曲線のYouden's index（感度+特異度-1を最大化する閾値）を利用すると最適な閾値を効率的に決定できます。


結果のフィルタリング（ルールベースのフィルター）
概要
モデルが出力した推論結果を、特定のルールを用いてフィルタリングし、明らかな誤分類や非現実的な結果を除外することで、精度を改善します。
具体的な手順
モデルが苦手とする誤分類パターンを特定します。
例：「犬」と「猫」を間違えやすい、あるいは「花瓶」と「コップ」を混同するなど。
ドメイン知識に基づいてルールを設計します。
例：「あるクラスが選ばれた時、必ず別のクラスの確率も見る」
「犬」クラスが0.6で予測されたが、「猫」クラスも0.4で高確率の場合は一旦保留し、より詳細な判定を行う。
他にも画像のメタ情報（日時・位置情報等）を利用し、明らかにあり得ない結果を除外する。
このフィルターを通して推論結果を最終決定します。
ルールベースフィルタリングの工夫
条件はシンプルにするほうが有効です。複雑すぎるルールは汎用性がなくなります。
あくまでも明らかな間違いを防ぐための仕組みとして導入しましょう。細かな判定はモデルに任せる方が無難です。
推奨する適用順序の例
推論時はまずTTAを実施し、予測結果を安定化。
その後、必要に応じて前処理アンサンブルを併用。
最終的に閾値調整およびルールベースのフィルターを適用することで、さらに精度を改善。

